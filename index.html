<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>2-Way Arbitrage Calculator with Draw Protection</title>
  <style>
    :root{
      --card-bg: #ffffff;
      --blue-1: #3aa0e6;
      --blue-2: #1f67a8;
      --dark-input: #2b2f36;
      --input-text: #ffffff;
      --muted: #6c7a89;
      --green-1: #dff4e0;
      --green-2: #c1eac2;
      --pink-1: #ffd7dc;
      --pink-2: #ffb3bf;
      --red-1: #ffdede;
      --max-width: 420px;
      --radius: 18px;
    }

    html,body{
      height:100%;
      margin:0;
      font-family: "Segoe UI", Roboto, Arial, sans-serif;
      background: linear-gradient(180deg, #f4fbff 0%, #edf6ff 100%);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      color: #102030;
    }

    .page-wrap{
      display:flex;
      align-items:center;
      justify-content:center;
      padding:18px 12px;
      min-height:100vh;
    }
    .container{
      width:100%;
      max-width:var(--max-width);
      background:var(--card-bg);
      border-radius:var(--radius);
      box-shadow:0 12px 30px rgba(16,24,40,0.12);
      overflow:hidden;
      border: 1px solid rgba(21,32,64,0.05);
    }

    .hero{
      background: linear-gradient(180deg, var(--blue-1), var(--blue-2));
      color:white;
      padding:14px 16px;
      text-align:center;
    }
    .hero h1{
      margin:0;
      font-size:1.05rem;
      line-height:1.2;
      font-weight:700;
      letter-spacing:0.2px;
    }

    .panel{
      padding:0;
      border-top: 1px solid rgba(16,24,40,0.04);
    }
    .panel-title{
      background: linear-gradient(180deg, #2e83c8, #1f67a8);
      color:white;
      font-weight:700;
      padding:10px 14px;
      font-size:0.95rem;
    }

    .instructions{
      padding:12px 14px 18px;
    }
    .instr-list{
      margin:8px 0 0 0;
      padding-left:16px;
      color:var(--muted);
      font-size:0.88rem;
    }
    .instr-list li{ margin:8px 0; }

    .section-button{
      width:100%;
      background:linear-gradient(180deg,#2196f3,#1976d2);
      color:white;
      border:none;
      padding:10px 12px;
      font-weight:700;
      text-transform:uppercase;
      font-size:0.9rem;
      display:block;
      cursor:default;
    }

    .form{
      padding:12px 0 18px;
      background:linear-gradient(180deg,#f5f9ff,#fbfdff);
    }
    .field-label{
      display:block;
      background:linear-gradient(180deg,#2b6fa8,#1f4f7a);
      color:white;
      font-weight:700;
      padding:8px 14px;
      font-size:0.9rem;
    }
    .field{
      padding:10px 14px;
      background:var(--card-bg);
      border-bottom:1px solid rgba(16,24,40,0.03);
    }
    .field input,
    .field select{
      width:100%;
      display:block;
      background:var(--dark-input);
      color:var(--input-text);
      border:none;
      padding:12px;
      font-size:0.95rem;
      border-radius:6px;
      box-shadow: inset 0 -2px 6px rgba(0,0,0,0.18);
    }
    .field select{ appearance:none; -webkit-appearance:none; }

    .action-btn{
      margin:14px;
      width:calc(100% - 28px);
      background:linear-gradient(180deg,#2ca3ff,#1d78d1);
      color:white;
      font-weight:700;
      padding:10px 14px;
      border-radius:8px;
      border:none;
      font-size:0.95rem;
    }

    .results, .two-way-results, .draw-protection{
      padding-bottom:14px;
    }
    .result-row{
      padding:12px 14px;
      border-top:1px solid rgba(16,24,40,0.03);
      font-size:0.95rem;
      display:flex;
      align-items:center;
      justify-content:space-between;
    }
    .result-row.label-only{
      background:linear-gradient(180deg,#f7fbff,#f4f9ff);
      color:var(--muted);
      font-weight:600;
    }
    .result-row.value{
      background:linear-gradient(180deg,var(--green-1),var(--green-2));
      color:#155724;
      font-weight:700;
    }
    .result-row.profit{
      background:linear-gradient(180deg,var(--green-1),var(--green-2));
      color:#155724;
      font-weight:800;
      box-shadow: inset 0 -2px 4px rgba(0,0,0,0.03);
    }

    .result-row.arb-yes{
      background:linear-gradient(180deg,#dff7e5,#c2efcf);
      color:#155724;
      font-weight:700;
    }

    .result-row.warning{
      background:linear-gradient(180deg,var(--pink-1),var(--pink-2));
      color:#7a1f32;
      font-weight:700;
    }
    .result-row.negative{
      background:linear-gradient(180deg,#fff1f4,#ffdbe0);
      color:#7a1f32;
      font-weight:700;
    }

    /* New profit positive / negative styles */
    .result-row.new-profit-positive{
      background:linear-gradient(180deg,var(--green-1),var(--green-2));
      color:#155724;
      font-weight:800;
    }
    .result-row.new-profit-negative{
      background:linear-gradient(180deg,var(--pink-1),var(--pink-2));
      color:#7a1f32;
      font-weight:800;
    }

    .footer{
      padding:10px 14px;
      text-align:center;
      color:var(--muted);
      font-size:0.78rem;
      border-top:1px solid rgba(16,24,40,0.04);
    }

    .muted { color: var(--muted); font-size:0.88rem; }
    .inline-note { font-size:0.82rem; color:var(--muted); margin-top:6px; padding:0 14px; }

    @media (min-width:440px){
      .page-wrap{ padding:30px; }
      .container{ border-radius:22px; }
    }
  </style>
</head>
<body>
  <div class="page-wrap">
    <div class="container">
      <header class="hero">
        <h1>2-Way Arbitrage Calculator with Draw Protection</h1>
      </header>

      <section class="panel instructions">
        <div class="panel-title">Instructions:</div>
        <div class="instructions">
          <ul class="instr-list">
            <li>Team A Odds: Enter decimal odds for Team A to win</li>
            <li>Team B Odds: Enter decimal odds for Team B to win</li>
            <li>Draw Odds (Optional): Enter draw odds to see protection analysis</li>
            <li>Minimum Bet: Enter minimum bet requirement for any restricted site</li>
            <li>Total Stake (Optional): Enter desired total stake; leave blank for auto</li>
            <li>Currency: Choose between USD ($) or NPR (रु)</li>
          </ul>
        </div>
      </section>

      <button class="section-button">INPUT PARAMETERS</button>

      <form id="arbForm" class="panel form" autocomplete="off">
        <label class="field-label">Team A Win Odds</label>
        <div class="field"><input id="oddsA" type="number" step="0.01" placeholder="2.1" required /></div>

        <label class="field-label">Team B Win Odds</label>
        <div class="field"><input id="oddsB" type="number" step="0.01" placeholder="2.0" required /></div>

        <label class="field-label">Draw/Tie Odds (Optional)</label>
        <div class="field"><input id="oddsDraw" type="number" step="0.01" placeholder="3.2" /></div>

        <label class="field-label">Minimum Bet Requirement</label>
        <div class="field"><input id="minBet" type="number" step="0.01" placeholder="100" /></div>

        <label class="field-label">Total Stake (Optional)</label>
        <div class="field"><input id="totalStake" type="number" step="0.01" placeholder="Leave blank for auto" /></div>

        <label class="field-label">Currency</label>
        <div class="field">
          <select id="currency">
            <option value="USD">$ USD ($)</option>
            <option value="NPR">रु NPR (Rs)</option>
          </select>
        </div>

        <button type="submit" class="action-btn">CALCULATIONS</button>
      </form>

      <section class="panel results">
        <div class="panel-title">CALCULATIONS</div>

        <div class="result-row label-only">Team A Win Probability</div>
        <div class="result-row value" id="probA">--</div>

        <div class="result-row label-only">Team B Win Probability</div>
        <div class="result-row value" id="probB">--</div>

        <div class="result-row label-only">Total Implied Probability</div>
        <div class="result-row value" id="implied">--</div>

        <div class="result-row label-only">Arbitrage Possible?</div>
        <div class="result-row arb-yes" id="arbPossible">--</div>

        <div class="result-row label-only">Warning</div>
        <div class="result-row warning" id="warning">--</div>
      </section>

      <section class="panel two-way-results">
        <div class="panel-title">2-WAY ARBITRAGE RESULTS</div>

        <div class="result-row label-only">Stake on Team A</div>
        <div class="result-row value" id="stakeA">$0.00</div>

        <div class="result-row label-only">Stake on Team B</div>
        <div class="result-row value" id="stakeB">$0.00</div>

        <div class="result-row label-only">Total Stake</div>
        <div class="result-row value" id="totalStk">$0.00</div>

        <div class="result-row label-only">Guaranteed Payout</div>
        <div class="result-row value" id="payout">$0.00</div>

        <div class="result-row label-only">Profit</div>
        <div class="result-row profit" id="profit">$0.00</div>

        <div class="result-row label-only">Profit Percentage</div>
        <div class="result-row value" id="profitPerc">0%</div>
      </section>

      <section class="panel draw-protection">
        <div class="panel-title">DRAW PROTECTION ANALYSIS</div>

        <div class="result-row label-only">Draw Probability</div>
        <div class="result-row value" id="drawProb">--</div>

        <div class="result-row label-only">Original 2-Way Profit</div>
        <div class="result-row value" id="origProfit">$0.00</div>

        <div class="result-row label-only">Draw Stake Needed (to break even on draw)</div>
        <div class="result-row negative" id="drawStakeNeeded">--</div>

        <div class="result-row label-only">Protected Profit</div>
        <div class="result-row value" id="protProfit">--</div>

        <div class="result-row label-only">Profit Reduction</div>
        <div class="result-row negative" id="profitReduction">--</div>

        <!-- New row requested by you: New Profit Percentage after draw protection -->
        <div class="result-row label-only">New Profit Percentage</div>
        <div class="result-row value" id="newProfitPerc">--</div>

        <div class="result-row label-only">Recommendation</div>
        <div class="result-row value" id="recommendation">--</div>

        <div class="result-row label-only">Cost vs Benefit</div>
        <div class="result-row value" id="costbenefit">--</div>
      </section>

      <footer class="footer">
        <small>Tip: Use browser devtools mobile view to preview a phone-like layout.</small>
      </footer>
    </div>
  </div>

  <script>
    // Formatting helpers
    function fmt(n, cur) {
      const precision = 2;
      if (n === null || n === undefined || isNaN(n)) return '--';
      if (cur === 'NPR') return 'रु ' + Number(n).toFixed(precision);
      return (cur === 'USD' ? '$' : '') + Number(n).toFixed(2);
    }

    function pctVal(v) {
      if (v === null || v === undefined || isNaN(v)) return '--';
      return (v * 100).toFixed(2) + '%';
    }

    function pctNumber(v) {
      if (v === null || v === undefined || isNaN(v)) return NaN;
      return Number(v);
    }

    document.getElementById('arbForm').addEventListener('submit', function(e){
      e.preventDefault();
      const oddsA = parseFloat(document.getElementById('oddsA').value);
      const oddsB = parseFloat(document.getElementById('oddsB').value);
      const oddsDraw = parseFloat(document.getElementById('oddsDraw').value);
      const minBet = parseFloat(document.getElementById('minBet').value) || 0;
      let totalStakeInput = parseFloat(document.getElementById('totalStake').value);
      const currency = document.getElementById('currency').value;

      if (!oddsA || !oddsB || oddsA <= 1 || oddsB <= 1) {
        alert('Please enter valid decimal odds (>1) for Team A and Team B.');
        return;
      }

      // Basic probabilities
      const pA = 1 / oddsA;
      const pB = 1 / oddsB;
      const sumP = pA + pB;

      // Auto total stake: choose a reasonable default if not provided
      let totalStake;
      if (!totalStakeInput || totalStakeInput <= 0) {
        const testTotal = Math.max(100, minBet * 2 || 100);
        totalStake = testTotal;
      } else {
        totalStake = totalStakeInput;
      }

      // stakes that produce equal payout
      const stakeA = totalStake * (pA / sumP);
      const stakeB = totalStake * (pB / sumP);
      const payout = stakeA * oddsA; // equal to stakeB * oddsB
      const profit = payout - totalStake;
      const profitPerc = (profit / totalStake) * 100;

      // Draw protection calculations (if draw odds supplied)
      let drawProb = null, drawStakeNeeded = null, protectedProfit = null, profitReduction = null, recommendation = '--', costbenefit = '--', newProfitPercentage = null;
      if (oddsDraw && oddsDraw > 1) {
        drawProb = 1 / oddsDraw;
        const lossOnDraw = totalStake; // both A and B lose
        // D * (oddsDraw - 1) >= totalStake  => D >= totalStake / (oddsDraw - 1)
        drawStakeNeeded = totalStake / (oddsDraw - 1);
        // If we place draw stake D as extra outlay, protectedProfit = original profit - D
        protectedProfit = profit - drawStakeNeeded;
        profitReduction = drawStakeNeeded; // how much profit reduced by protecting

        // New profit percentage relative to total outlay (totalStake + drawStakeNeeded)
        const totalOutlay = totalStake + drawStakeNeeded;
        if (!isNaN(protectedProfit) && isFinite(totalOutlay) && totalOutlay > 0) {
          newProfitPercentage = (protectedProfit / totalOutlay) * 100;
        }

        // Simple recommendation heuristic
        if (drawStakeNeeded <= 0 || !isFinite(drawStakeNeeded)) {
          recommendation = 'Not Applicable';
          costbenefit = 'N/A';
        } else {
          const costRatio = drawStakeNeeded / totalStake;
          if (costRatio > 1.5) {
            recommendation = '❌ Not Recommended';
            costbenefit = 'Very High Cost';
          } else if (costRatio > 0.6) {
            recommendation = '⚠️ Consider Carefully';
            costbenefit = 'High Cost';
          } else {
            recommendation = '✅ Maybe Worth It';
            costbenefit = 'Low Cost';
          }
        }
      }

      // Populate UI
      document.getElementById('probA').textContent = pctVal(pA);
      document.getElementById('probB').textContent = pctVal(pB);
      document.getElementById('implied').textContent = (sumP * 100).toFixed(2) + '%';
      document.getElementById('arbPossible').textContent = (sumP < 1) ? 'Yes' : 'No';
      document.getElementById('warning').textContent = (sumP < 1) ? '--' : (sumP === 1 ? 'No margin (exact fairness)' : 'No arbitrage — implied probability >= 100%');

      const curSym = currency;

      document.getElementById('stakeA').textContent = fmt(stakeA, curSym);
      document.getElementById('stakeB').textContent = fmt(stakeB, curSym);
      document.getElementById('totalStk').textContent = fmt(totalStake, curSym);
      document.getElementById('payout').textContent = fmt(payout, curSym);
      document.getElementById('profit').textContent = fmt(profit, curSym);
      document.getElementById('profitPerc').textContent = profitPerc.toFixed(2) + '%';

      document.getElementById('drawProb').textContent = drawProb ? pctVal(drawProb) : '--';
      document.getElementById('origProfit').textContent = fmt(profit, curSym);
      document.getElementById('drawStakeNeeded').textContent = drawStakeNeeded ? fmt(drawStakeNeeded, curSym) : '--';
      document.getElementById('protProfit').textContent = (protectedProfit !== null && protectedProfit !== undefined && !isNaN(protectedProfit)) ? fmt(protectedProfit, curSym) : '--';
      document.getElementById('profitReduction').textContent = profitReduction ? fmt(profitReduction, curSym) : '--';
      document.getElementById('recommendation').textContent = recommendation;
      document.getElementById('costbenefit').textContent = costbenefit;

      // New Profit Percentage row: update text and color (green if >0, red with minus sign if <0)
      const newProfitEl = document.getElementById('newProfitPerc');
      if (newProfitPercentage === null || isNaN(newProfitPercentage)) {
        newProfitEl.textContent = '--';
        newProfitEl.className = 'result-row value';
      } else {
        const rounded = Math.abs(newProfitPercentage).toFixed(2) + '%';
        if (newProfitPercentage > 0) {
          newProfitEl.textContent = rounded;
          newProfitEl.className = 'result-row new-profit-positive';
        } else if (newProfitPercentage < 0) {
          // show minus sign in front
          newProfitEl.textContent = '-' + rounded;
          newProfitEl.className = 'result-row new-profit-negative';
        } else {
          newProfitEl.textContent = '0.00%';
          newProfitEl.className = 'result-row value';
        }
      }
    });

    // Prefill sample values to match screenshot-like example
    window.addEventListener('load', () => {
      document.getElementById('oddsA').value = '2.1';
      document.getElementById('oddsB').value = '2.0';
      document.getElementById('oddsDraw').value = '3.2';
      document.getElementById('minBet').value = '100';
      // totalStake left blank for auto default
    });
  </script>
</body>
</html>