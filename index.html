<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>2-Way and 3-Way Arbitrage Calculator with Draw Protection</title>
  <style>
    :root{
      --card-bg: #ffffff;
      --bg-start: #f4fbff;
      --bg-end: #eef6ff;
      --accent-1: #4aa3e0;
      --accent-2: #1f67a8;
      --muted: #6c7a89;
      --input-bg: #2b2f36;
      --input-color: #ffffff;
      --green-1: #dff4e0;
      --green-2: #c1eac2;
      --pink-1: #ffd7dc;
      --pink-2: #ffb3bf;
      --max-width: 440px;
      --radius: 18px;
    }

    html,body{height:100%;margin:0;font-family:Inter, "Segoe UI", Roboto, Arial, sans-serif;background:linear-gradient(180deg,var(--bg-start),var(--bg-end));color:#102030;-webkit-font-smoothing:antialiased;}

    .page-wrap{display:flex;align-items:center;justify-content:center;padding:20px;min-height:100vh}
    .container{width:100%;max-width:var(--max-width);background:var(--card-bg);border-radius:var(--radius);box-shadow:0 18px 40px rgba(16,24,40,0.12);overflow:hidden;border:1px solid rgba(21,32,64,0.06)}

    .hero{background:linear-gradient(180deg,var(--accent-1),var(--accent-2));color:white;padding:18px 16px;text-align:center}
    .hero h1{margin:0;font-size:1.05rem;line-height:1.2;font-weight:800}
    .hero p{margin:6px 0 0;font-size:0.85rem;opacity:0.95}

    .panel{border-top:1px solid rgba(16,24,40,0.04)}
    .panel-title{background:linear-gradient(180deg,#2e83c8,#1f67a8);color:white;font-weight:700;padding:10px 14px;font-size:0.95rem}

    .instructions{padding:14px}
    .instr-list{margin:8px 0 0 0;padding-left:16px;color:var(--muted);font-size:0.9rem}
    .instr-list li{margin:8px 0}
    .instr-note{font-size:0.86rem;color:var(--muted);margin-top:8px}

    .section-button{width:100%;background:linear-gradient(180deg,#3ea8ff,#1f78d1);color:white;border:none;padding:10px 12px;font-weight:700;text-transform:uppercase;font-size:0.9rem;display:block}

    .form{padding:12px 0 18px;background:linear-gradient(180deg,#fbfdff,#f5f9ff)}
    .field-label{display:block;background:linear-gradient(180deg,#2b6fa8,#1f4f7a);color:white;font-weight:700;padding:8px 14px;font-size:0.9rem}
    .field{padding:10px 14px;background:var(--card-bg);border-bottom:1px solid rgba(16,24,40,0.03)}
    input[type="number"], select{width:100%;display:block;background:var(--input-bg);color:var(--input-color);border:none;padding:12px;font-size:0.95rem;border-radius:8px;box-shadow:inset 0 -2px 6px rgba(0,0,0,0.18)}
    input::placeholder{color:#cbd6e0}

    .two-cols{display:grid;grid-template-columns:1fr 1fr;gap:10px}

    .action-btn{margin:14px;width:calc(100% - 28px);background:linear-gradient(180deg,#2ca3ff,#1d78d1);color:white;font-weight:800;padding:12px;border-radius:10px;border:none;font-size:0.98rem}

    .results, .three-way-results, .two-way-results, .draw-protection{padding-bottom:12px}
    .result-row{padding:12px 14px;border-top:1px solid rgba(16,24,40,0.03);font-size:0.95rem;display:flex;align-items:center;justify-content:space-between}
    .label-only{background:linear-gradient(180deg,#f7fbff,#f4f9ff);color:var(--muted);font-weight:700}
    .value{background:linear-gradient(180deg,var(--green-1),var(--green-2));color:#155724;font-weight:800;padding-left:14px;padding-right:14px;border-radius:6px}
    .profit{background:linear-gradient(180deg,var(--green-1),var(--green-2));color:#0b662e;font-weight:900}
    .danger{background:linear-gradient(180deg,var(--pink-1),var(--pink-2));color:#7a1f32;font-weight:800}
    .neutral{background:#f3f6fb;color:var(--muted);font-weight:700}

    .small{font-size:0.85rem;color:var(--muted)}

    /* new profit positive/negative */
    .new-profit-positive{background:linear-gradient(180deg,var(--green-1),var(--green-2));color:#155724;font-weight:800}
    .new-profit-negative{background:linear-gradient(180deg,var(--pink-1),var(--pink-2));color:#7a1f32;font-weight:800}

    .footer{padding:12px 14px;text-align:center;color:var(--muted);font-size:0.78rem;border-top:1px solid rgba(16,24,40,0.04)}

    @media (min-width:520px){.page-wrap{padding:40px}.container{border-radius:22px}}
  </style>
</head>
<body>
  <div class="page-wrap">
    <div class="container">
      <header class="hero">
        <h1>2-Way and 3-Way Arbitrage Calculator</h1>
        <p>Includes draw-protection analysis and minimum-bet site handling</p>
      </header>

      <section class="panel instructions">
        <div class="panel-title">Instructions:</div>
        <div class="instructions">
          <ul class="instr-list">
            <li>Enter decimal odds from the bookmakers in the fields below.</li>
            <li>If one of the websites requires a minimum bet, choose which outcome it applies to using "Min Bet Applies To" and enter the minimum amount in the "Minimum Bet" field. Put the odds from that website in the corresponding outcome field (Team A / Team B / Draw).</li>
            <li>Draw odds are optional. If provided, the calculator will show a 3-way analysis and a draw-protection suggestion.</li>
            <li>If you leave Total Stake blank the app will pick a sensible default (max(100, minBet*2)).</li>
            <li>Currency set to NPR only (rupee) — amounts show as रु ...</li>
          </ul>
          <div class="instr-note">Example: If bookmaker X requires a minimum ₹200 on Team A, select "Team A" in "Min Bet Applies To", enter 200 in Minimum Bet, and put bookmaker X's odds into Team A odds field.</div>
        </div>
      </section>

      <button class="section-button">INPUT PARAMETERS</button>

      <form id="arbForm" class="panel form" autocomplete="off">
        <label class="field-label">Team A Win Odds</label>
        <div class="field"><input id="oddsA" type="number" step="0.01" placeholder="2.1" required></div>

        <label class="field-label">Team B Win Odds</label>
        <div class="field"><input id="oddsB" type="number" step="0.01" placeholder="2.0" required></div>

        <label class="field-label">Draw/Tie Odds (Optional)</label>
        <div class="field"><input id="oddsDraw" type="number" step="0.01" placeholder="3.2"></div>

        <div class="two-cols">
          <div>
            <label class="field-label">Min Bet Applies To</label>
            <div class="field">
              <select id="minBetApplies">
                <option value="none">None</option>
                <option value="A">Team A</option>
                <option value="B">Team B</option>
                <option value="D">Draw</option>
              </select>
            </div>
          </div>

          <div>
            <label class="field-label">Minimum Bet Amount (NPR)</label>
            <div class="field"><input id="minBet" type="number" step="0.01" placeholder="100"></div>
          </div>
        </div>

        <label class="field-label">Total Stake (Optional)</label>
        <div class="field"><input id="totalStake" type="number" step="0.01" placeholder="Leave blank for auto"></div>

        <div style="padding:10px 14px"><button type="submit" class="action-btn">CALCULATE</button></div>
      </form>

      <section class="panel results">
        <div class="panel-title">CALCULATIONS</div>

        <div class="result-row label-only">Team A Win Probability</div>
        <div class="result-row value" id="probA">--</div>

        <div class="result-row label-only">Team B Win Probability</div>
        <div class="result-row value" id="probB">--</div>

        <div class="result-row label-only">Draw Win Probability</div>
        <div class="result-row value" id="probD">--</div>

        <div class="result-row label-only">Total Implied Probability (2-way)</div>
        <div class="result-row neutral" id="implied2">--</div>

        <div class="result-row label-only">Total Implied Probability (3-way)</div>
        <div class="result-row neutral" id="implied3">--</div>

        <div class="result-row label-only">Arbitrage Possible (2-way)</div>
        <div class="result-row neutral" id="arb2">--</div>

        <div class="result-row label-only">Arbitrage Possible (3-way)</div>
        <div class="result-row neutral" id="arb3">--</div>

        <div class="result-row label-only">Warning</div>
        <div class="result-row danger" id="warning">--</div>
      </section>

      <section class="panel two-way-results">
        <div class="panel-title">2-WAY ARBITRAGE RESULTS</div>

        <div class="result-row label-only">Stake on Team A</div>
        <div class="result-row value" id="stakeA">रु 0.00</div>

        <div class="result-row label-only">Stake on Team B</div>
        <div class="result-row value" id="stakeB">रु 0.00</div>

        <div class="result-row label-only">Total Stake</div>
        <div class="result-row value" id="totalStk">रु 0.00</div>

        <div class="result-row label-only">Guaranteed Payout</div>
        <div class="result-row value" id="payout">रु 0.00</div>

        <div class="result-row label-only">Profit</div>
        <div class="result-row profit" id="profit">रु 0.00</div>

        <div class="result-row label-only">Profit Percentage</div>
        <div class="result-row value" id="profitPerc">0%</div>
      </section>

      <section class="panel three-way-results">
        <div class="panel-title">3-WAY ARBITRAGE RESULTS</div>

        <div class="result-row label-only">Stake on Team A</div>
        <div class="result-row value" id="stake3A">रु 0.00</div>

        <div class="result-row label-only">Stake on Team B</div>
        <div class="result-row value" id="stake3B">रु 0.00</div>

        <div class="result-row label-only">Stake on Draw</div>
        <div class="result-row value" id="stake3D">रु 0.00</div>

        <div class="result-row label-only">Total Stake</div>
        <div class="result-row value" id="totalStk3">रु 0.00</div>

        <div class="result-row label-only">Guaranteed Payout (each outcome)</div>
        <div class="result-row value" id="payout3">रु 0.00</div>

        <div class="result-row label-only">Profit (3-way)</div>
        <div class="result-row profit" id="profit3">रु 0.00</div>

        <div class="result-row label-only">Profit Percentage (3-way)</div>
        <div class="result-row value" id="profitPerc3">0%</div>
      </section>

      <section class="panel draw-protection">
        <div class="panel-title">DRAW PROTECTION ANALYSIS</div>

        <div class="result-row label-only">Draw Probability</div>
        <div class="result-row value" id="drawProb">--</div>

        <div class="result-row label-only">Original 2-Way Profit</div>
        <div class="result-row value" id="origProfit">रु 0.00</div>

        <div class="result-row label-only">Draw Stake Needed (to break even on draw)</div>
        <div class="result-row danger" id="drawStakeNeeded">--</div>

        <div class="result-row label-only">Protected Profit (after placing draw bet)</div>
        <div class="result-row value" id="protProfit">--</div>

        <div class="result-row label-only">Profit Reduction</div>
        <div class="result-row danger" id="profitReduction">--</div>

        <div class="result-row label-only">New Profit Percentage (post-draw)</div>
        <div class="result-row value" id="newProfitPerc">--</div>

        <div class="result-row label-only">Recommendation</div>
        <div class="result-row neutral" id="recommendation">--</div>

        <div class="result-row label-only">Cost vs Benefit</div>
        <div class="result-row neutral" id="costbenefit">--</div>
      </section>

      <footer class="footer">Tip: open devtools Mobile view to preview phone layout.</footer>
    </div>
  </div>

  <script>
    // helpers
    function fmt(n){ if (n === null || n === undefined || isNaN(n)) return '--'; return 'रु ' + Number(n).toFixed(2); }
    function pct(v){ if (v===null||v===undefined||isNaN(v)) return '--'; return (v*100).toFixed(2) + '%'; }

    document.getElementById('arbForm').addEventListener('submit', function(e){
      e.preventDefault();
      const oddsA = parseFloat(document.getElementById('oddsA').value);
      const oddsB = parseFloat(document.getElementById('oddsB').value);
      const oddsD = parseFloat(document.getElementById('oddsDraw').value);
      const minBet = parseFloat(document.getElementById('minBet').value) || 0;
      const minApplies = document.getElementById('minBetApplies').value; // 'A','B','D','none'
      let totalStakeInput = parseFloat(document.getElementById('totalStake').value);

      if (!oddsA || !oddsB || oddsA<=1 || oddsB<=1){ alert('Please enter valid decimal odds (>1) for Team A and Team B.'); return; }

      // probabilities
      const pA = 1/oddsA; const pB = 1/oddsB; const pD = (oddsD && oddsD>1) ? 1/oddsD : 0;
      const sum2 = pA + pB; const sum3 = pA + pB + pD;

      // total stake default
      let totalStake = (totalStakeInput && totalStakeInput>0) ? totalStakeInput : Math.max(100, (minBet||0)*2 || 100);

      // 2-way stakes (proportional to implied probs for available two outcomes)
      const stakeA = totalStake * (pA / sum2);
      const stakeB = totalStake * (pB / sum2);
      const payout2 = stakeA * oddsA; // equal
      const profit2 = payout2 - totalStake;
      const profitPerc2 = (profit2/totalStake)*100;

      // 3-way if draw provided
      let stake3A='--', stake3B='--', stake3D='--', payout3='--', profit3='--', profitPerc3='--';
      if (oddsD && oddsD>1){
        const stake3a = totalStake * (pA / sum3);
        const stake3b = totalStake * (pB / sum3);
        const stake3d = totalStake * (pD / sum3);
        const payout_3 = stake3a * oddsA; // equal to others
        const profit_3 = payout_3 - totalStake;
        stake3A = fmt(stake3a); stake3B = fmt(stake3b); stake3D = fmt(stake3d); payout3 = fmt(payout_3); profit3 = fmt(profit_3); profitPerc3 = ((profit_3/totalStake)*100).toFixed(2) + '%';
      }

      // draw protection calculations: attempt to hedge draw so draw outcome doesn't cause total loss
      let drawProb = (oddsD && oddsD>1) ? (1/oddsD) : null;
      let drawStakeNeeded = null, protectedProfit=null, profitReduction=null, newProfitPercentage=null;
      if (oddsD && oddsD>1){
        // when draw happens, A and B lose => loss = totalStake
        // need D such that D*(oddsD - 1) >= totalStake
        drawStakeNeeded = totalStake / (oddsD - 1);
        protectedProfit = profit2 - drawStakeNeeded; // placing draw stake reduces original profit
        profitReduction = drawStakeNeeded;
        const totalOutlay = totalStake + drawStakeNeeded;
        if (isFinite(totalOutlay) && totalOutlay>0){ newProfitPercentage = (protectedProfit/totalOutlay)*100; }
      }

      // Recommendation logic: prefer protectedProfit positive AND newProfitPercentage positive and cost reasonable
      let recommendation='--', costbenefit='--';
      if (drawStakeNeeded === null || !isFinite(drawStakeNeeded)){
        recommendation='N/A'; costbenefit='N/A';
      } else {
        if (protectedProfit <= 0 || newProfitPercentage === null || newProfitPercentage <= 0){
          recommendation = '❌ Not Recommended';
          costbenefit = 'Protection eliminates profit or yields negative return';
        } else {
          const costRatio = drawStakeNeeded/totalStake;
          if (costRatio > 1.5){ recommendation='❌ Not Recommended'; costbenefit='Very High Cost'; }
          else if (costRatio > 0.6){ recommendation='⚠️ Consider Carefully'; costbenefit='High Cost'; }
          else { recommendation='✅ Maybe Worth It'; costbenefit='Low Cost'; }
        }
      }

      // If min bet applies, ensure stake on that outcome meets minBet; if not, suggest increasing totalStake
      let minWarning='--';
      if (minApplies !== 'none' && minBet>0){
        let stakeOn = 0;
        if (minApplies==='A') stakeOn = stakeA;
        if (minApplies==='B') stakeOn = stakeB;
        if (minApplies==='D') stakeOn = (oddsD && oddsD>1) ? (totalStake * (pD / sum3)) : 0; // approximate
        if (stakeOn < minBet){ minWarning = 'Stake on selected outcome is below minimum — consider raising Total Stake or not using that market'; } else { minWarning='--'; }
      }

      // populate UI
      document.getElementById('probA').textContent = pct(pA);
      document.getElementById('probB').textContent = pct(pB);
      document.getElementById('probD').textContent = (pD? pct(pD): '--');
      document.getElementById('implied2').textContent = (sum2*100).toFixed(2) + '%';
      document.getElementById('implied3').textContent = (sum3*100).toFixed(2) + '%';
      document.getElementById('arb2').textContent = (sum2 < 1) ? 'Yes' : 'No';
      document.getElementById('arb3').textContent = (oddsD && oddsD>1) ? ((sum3 < 1) ? 'Yes' : 'No') : 'N/A';
      document.getElementById('warning').textContent = (sum2<1 || (sum3<1 && oddsD>1))? (minWarning==='--'? '--':minWarning) : 'No arbitrage detected';

      document.getElementById('stakeA').textContent = fmt(stakeA);
      document.getElementById('stakeB').textContent = fmt(stakeB);
      document.getElementById('totalStk').textContent = fmt(totalStake);
      document.getElementById('payout').textContent = fmt(payout2);
      document.getElementById('profit').textContent = fmt(profit2);
      document.getElementById('profitPerc').textContent = profitPerc2.toFixed(2) + '%';

      document.getElementById('stake3A').textContent = stake3A;
      document.getElementById('stake3B').textContent = stake3B;
      document.getElementById('stake3D').textContent = stake3D;
      document.getElementById('totalStk3').textContent = fmt(totalStake);
      document.getElementById('payout3').textContent = payout3;
      document.getElementById('profit3').textContent = profit3;
      document.getElementById('profitPerc3').textContent = profitPerc3;

      document.getElementById('drawProb').textContent = drawProb? pct(drawProb): '--';
      document.getElementById('origProfit').textContent = fmt(profit2);
      document.getElementById('drawStakeNeeded').textContent = drawStakeNeeded? fmt(drawStakeNeeded): '--';
      document.getElementById('protProfit').textContent = (protectedProfit!==null && protectedProfit!==undefined && !isNaN(protectedProfit))? fmt(protectedProfit): '--';
      document.getElementById('profitReduction').textContent = profitReduction? fmt(profitReduction): '--';

      // new profit percentage styling
      const newProfitEl = document.getElementById('newProfitPerc');
      if (newProfitPercentage===null || newProfitPercentage===undefined || isNaN(newProfitPercentage)){
        newProfitEl.textContent = '--'; newProfitEl.className='result-row value';
      } else {
        const val = Number(newProfitPercentage);
        const txt = Math.abs(val).toFixed(2) + '%';
        if (val>0){ newProfitEl.textContent = txt; newProfitEl.className='result-row new-profit-positive'; }
        else if (val<0){ newProfitEl.textContent = '-' + txt; newProfitEl.className='result-row new-profit-negative'; }
        else { newProfitEl.textContent = '0.00%'; newProfitEl.className='result-row value'; }
      }

      document.getElementById('recommendation').textContent = recommendation;
      document.getElementById('costbenefit').textContent = costbenefit;

    });

    // preload sample
    window.addEventListener('load', ()=>{
      document.getElementById('oddsA').value='2.1';
      document.getElementById('oddsB').value='2.0';
      document.getElementById('oddsDraw').value='3.2';
      document.getElementById('minBet').value='100';
    });
  </script>
</body>
</html>