<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Arbitrage Calculator — 2‑Way & 3‑Way</title>
  <style>
    :root{
      --bg:#0f1724;
      --card:#0b1220;
      --glass: rgba(255,255,255,0.03);
      --muted: #98a4b8;
      --accent:#4fb6ff;
      --accent-2:#5fe6c5;
      --danger:#ff6b7a;
      --success:#28c76f;
      --maxw:900px;
      --radius:16px;
      --glass-2: rgba(255,255,255,0.02);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#071021 0%, #071827 50%, #04121b 100%);color:#e6eef6}
    .wrap{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:28px}
    .app{width:100%;max-width:var(--maxw);display:grid;grid-template-columns:420px 1fr;gap:24px}
    .card{background:linear-gradient(180deg,var(--card), #041224);border-radius:var(--radius);padding:18px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 12px 30px rgba(2,6,23,0.6)}
    header.app-head{grid-column:1/-1;display:flex;align-items:center;gap:14px}
    .brand{display:flex;flex-direction:column}
    .brand h1{margin:0;font-size:1.05rem;letter-spacing:0.2px}
    .brand p{margin:2px 0 0;font-size:0.85rem;color:var(--muted)}

    .controls{display:flex;flex-direction:column;gap:12px}
    label.small{font-size:0.78rem;color:var(--muted);display:block;margin-bottom:6px}
    .input{background:var(--glass);padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.03)}
    input[type=number], select{width:100%;background:transparent;border:none;color:inherit;font-size:0.98rem;padding:6px;outline:none}

    .row{display:flex;gap:10px}
    .col{flex:1}
    .btn{background:linear-gradient(90deg,var(--accent),#2f9bff);border:none;color:#04202a;padding:10px 12px;border-radius:10px;font-weight:700;cursor:pointer}
    .ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted);padding:8px;border-radius:10px}

    /* results pane */
    .results{padding:18px;display:flex;flex-direction:column;gap:12px}
    .tile{background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);border-radius:12px;padding:12px;border:1px solid rgba(255,255,255,0.03);display:flex;justify-content:space-between;align-items:center}
    .tile h3{margin:0;font-size:0.86rem;color:var(--muted)}
    .big{font-weight:800;color:#e6f7ff}
    .muted{color:var(--muted)}
    .value-pill{padding:6px 10px;border-radius:999px;background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));font-weight:800;color:inherit;min-width:90px;text-align:right}

    .positive{background:linear-gradient(90deg, rgba(40,199,111,0.12), rgba(40,199,111,0.06));color:var(--success);border-radius:8px;padding:6px 8px;font-weight:800}
    .negative{background:linear-gradient(90deg, rgba(255,107,122,0.08), rgba(255,107,122,0.04));color:var(--danger);border-radius:8px;padding:6px 8px;font-weight:800}

    .smallnote{font-size:0.82rem;color:var(--muted)}
    .hide{display:none}

    /* suggestions content formatting */
    .suggestions-text{white-space:pre-wrap;text-align:left;max-width:640px}

    /* animations */
    .fade{transition:all .28s cubic-bezier(.2,.9,.2,1);opacity:1;transform:translateY(0)}
    .fade.hide{opacity:0;transform:translateY(-6px)}

    footer.foot{grid-column:1/-1;text-align:center;color:var(--muted);font-size:0.82rem;padding-top:6px}

    @media (max-width:980px){.app{grid-template-columns:1fr;}.card{padding:14px}}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="app">
      <header class="app-head">
        <div class="card" style="flex:0 0 280px;display:flex;flex-direction:column;gap:10px">
          <div style="display:flex;align-items:center;gap:10px">
            <svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="6" fill="#2f9bff"/></svg>
            <div class="brand"><h1>Arb Studio</h1><p>2‑Way & 3‑Way arbitrage — draw protection</p></div>
          </div>

          <div class="controls">
            <div>
              <label class="small">Mode</label>
              <div class="input"><select id="modeSelect"><option value="2">2‑Way (no draw)</option><option value="3">3‑Way (draw included)</option></select></div>
            </div>

            <div>
              <label class="small">Team A Odds (decimal)</label>
              <div class="input"><input id="oddsA" type="number" step="0.01" placeholder="2.10" /></div>
            </div>

            <div>
              <label class="small">Team B Odds (decimal)</label>
              <div class="input"><input id="oddsB" type="number" step="0.01" placeholder="2.00" /></div>
            </div>

            <div id="drawRow">
              <label class="small">Draw/Tie Odds (decimal) — optional for 2‑Way</label>
              <div class="input"><input id="oddsDraw" type="number" step="0.01" placeholder="3.20" /></div>
            </div>

            <div style="display:flex;gap:8px">
              <div style="flex:1">
                <label class="small">Min Bet Applies To</label>
                <div class="input"><select id="minBetApplies"><option value="none">None</option><option value="A">Team A</option><option value="B">Team B</option><option value="D">Draw</option></select></div>
              </div>
              <div style="width:120px">
                <label class="small">Minimum Bet (रु)</label>
                <div class="input"><input id="minBet" type="number" step="0.01" placeholder="100" /></div>
              </div>
            </div>

            <div>
              <label class="small">Total Stake (रु) — optional</label>
              <div class="input"><input id="totalStake" type="number" step="0.01" placeholder="Leave blank for auto" /></div>
            </div>

            <div style="display:flex;gap:8px;margin-top:6px">
              <button id="calcBtn" class="btn">Calculate</button>
              <button id="resetBtn" class="ghost">Reset</button>
            </div>

            <div class="smallnote">All amounts shown in NPR (रु). When in 2‑Way mode, draw analytics only appear if draw odds are entered.</div>
          </div>
        </div>

        <div class="card" style="flex:1;display:flex;flex-direction:column;gap:12px">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <h2 style="margin:0;font-size:1.02rem">Results</h2>
              <div class="smallnote">Interactive analysis — switch mode to hide/show sections</div>
            </div>
            <div class="smallnote" id="arbBadge">Status: —</div>
          </div>

          <div id="resultsPane" class="results">
            <!-- Probabilities -->
            <div class="tile"><h3>Team A Probability</h3><div class="value-pill" id="probA">--</div></div>
            <div class="tile"><h3>Team B Probability</h3><div class="value-pill" id="probB">--</div></div>
            <div id="probDrawTile" class="tile"><h3>Draw Probability</h3><div class="value-pill" id="probD">--</div></div>

            <div id="implied2Tile" class="tile"><h3>Implied Probability (2‑way)</h3><div class="value-pill" id="implied2">--</div></div>
            <div id="implied3Tile" class="tile"><h3>Implied Probability (3‑way)</h3><div class="value-pill" id="implied3">--</div></div>

            <!-- 2-way area -->
            <div id="twoWayArea">
              <div class="tile"><h3>2‑Way — Stake on A</h3><div class="value-pill" id="stakeA">रु 0.00</div></div>
              <div class="tile"><h3>2‑Way — Stake on B</h3><div class="value-pill" id="stakeB">रु 0.00</div></div>
              <div class="tile"><h3>Total Stake</h3><div class="value-pill" id="totalStk">रु 0.00</div></div>
              <div class="tile"><h3>Guaranteed Payout</h3><div class="value-pill" id="payout">रु 0.00</div></div>
              <div class="tile"><h3>Profit (2‑way)</h3><div class="value-pill" id="profit">रु 0.00</div></div>
              <div class="tile"><h3>Profit % (2‑way)</h3><div class="value-pill" id="profitPerc">0%</div></div>
            </div>

            <!-- 3-way area -->
            <div id="threeWayArea">
              <div class="tile"><h3>3‑Way — Stake on A</h3><div class="value-pill" id="stake3A">रु 0.00</div></div>
              <div class="tile"><h3>3‑Way — Stake on B</h3><div class="value-pill" id="stake3B">रु 0.00</div></div>
              <div class="tile"><h3>3‑Way — Stake on Draw</h3><div class="value-pill" id="stake3D">रु 0.00</div></div>
              <div class="tile"><h3>3‑Way — Total Stake</h3><div class="value-pill" id="totalStk3">रु 0.00</div></div>
              <div class="tile"><h3>Guaranteed Payout (each)</h3><div class="value-pill" id="payout3">रु 0.00</div></div>
              <div class="tile"><h3>Profit (3‑way)</h3><div class="value-pill" id="profit3">रु 0.00</div></div>
              <div class="tile"><h3>Profit % (3‑way)</h3><div class="value-pill" id="profitPerc3">0%</div></div>
            </div>

            <!-- draw protection area (only for 2-way when draw odds present) -->
            <div id="drawArea">
              <div class="tile"><h3>Draw Probability</h3><div class="value-pill" id="drawProb">--</div></div>
              <div class="tile"><h3>Original 2‑Way Profit</h3><div class="value-pill" id="origProfit">रु 0.00</div></div>
              <div class="tile"><h3>Draw Stake Needed (to break even)</h3><div class="value-pill" id="drawStakeNeeded">--</div></div>
              <div class="tile"><h3>Protected Profit (after draw bet)</h3><div class="value-pill" id="protProfit">--</div></div>
              <div class="tile"><h3>Profit Reduction</h3><div class="value-pill" id="profitReduction">--</div></div>
              <div class="tile"><h3>New Profit % (post‑draw)</h3><div class="value-pill" id="newProfitPerc">--</div></div>
              <div class="tile"><h3>Recommendation</h3><div class="value-pill" id="recommendation">--</div></div>
              <div class="tile"><h3>Cost vs Benefit</h3><div class="value-pill muted" id="costbenefit">--</div></div>

              <div class="tile hide" id="threeWaySuggestion"><h3>3‑Way vs Hedging</h3><div class="value-pill" id="threeWaySuggestText">--</div></div>
            </div>

            <!-- Suggestions -->
            <div id="suggestionsArea" class="tile hide"><h3>Pre‑bet Suggestions / Checklist</h3><div class="value-pill muted suggestions-text" id="suggestionsText">--</div></div>

          </div>
        </div>
      </header>

      <footer class="foot">Tip: choose mode to switch between 2‑Way and 3‑Way analysis. Draw analytics shown in 2‑Way only if draw odds are entered.</footer>
    </div>
  </div>

  <script>
    // helpers
    const $ = id => document.getElementById(id);
    function fmt(n){ if (n===null||n===undefined||isNaN(n)) return '--'; return 'रु ' + Number(n).toFixed(2); }
    function pct(v){ if (v===null||v===undefined||isNaN(v)) return '--'; return (v*100).toFixed(2) + '%'; }

    // elements
    const modeSelect = $('modeSelect');
    const drawRow = $('drawRow');
    const twoWayArea = $('twoWayArea');
    const threeWayArea = $('threeWayArea');
    const drawArea = $('drawArea');
    const probDrawTile = $('probDrawTile');
    const implied3Tile = $('implied3Tile');
    const implied2Tile = $('implied2Tile');
    const arbBadge = $('arbBadge');
    const threeWaySuggestion = $('threeWaySuggestion');
    const threeWaySuggestText = $('threeWaySuggestText');
    const suggestionsArea = $('suggestionsArea');
    const suggestionsText = $('suggestionsText');

    function setVisibility(){
      const mode = modeSelect.value; // '2' or '3'
      if (mode === '2'){
        twoWayArea.classList.remove('hide');
        implied2Tile.classList.remove('hide');
        implied3Tile.classList.add('hide');
        threeWayArea.classList.add('hide');
      } else {
        twoWayArea.classList.add('hide');
        implied2Tile.classList.add('hide');
        threeWayArea.classList.remove('hide');
        implied3Tile.classList.remove('hide');
        drawArea.classList.add('hide');
        probDrawTile.classList.remove('hide');
      }
    }

    modeSelect.addEventListener('change', ()=>{ setVisibility(); clearResults(); });

    function clearResults(){
      const ids = ['probA','probB','probD','implied2','implied3','stakeA','stakeB','totalStk','payout','profit','profitPerc','stake3A','stake3B','stake3D','totalStk3','payout3','profit3','profitPerc3','drawProb','origProfit','drawStakeNeeded','protProfit','profitReduction','newProfitPerc','recommendation','costbenefit','threeWaySuggestText','suggestionsText'];
      ids.forEach(id=>{
        const el = $(id);
        if (!el) return;
        // default textual values
        if (id === 'profit' || id === 'profit3' || id === 'origProfit') el.textContent = 'रु 0.00';
        else if (id === 'profitPerc' || id === 'profitPerc3' || id === 'newProfitPerc') el.textContent = '0%';
        else el.textContent = '--';
        el.className = 'value-pill';
      });
      arbBadge.textContent = 'Status: —';
      threeWaySuggestion.classList.add('hide');
      suggestionsArea.classList.add('hide');
    }

    function validateOdds(a,b,draw){
      if (!a || a<=1 || !b || b<=1) { alert('Please enter valid decimal odds (>1) for Team A and Team B.'); return false; }
      if (modeSelect.value === '3' && (!draw || draw<=1)) { alert('3‑Way mode requires draw/tie odds (>1).'); return false; }
      if (draw && draw<=1){ alert('If provided, draw odds must be > 1'); return false; }
      return true;
    }

    function applyValueClass(el, value, isPercent){
      if (!el) return;
      // reset to base
      el.className = 'value-pill';
      if (value === null || value === undefined || isNaN(value)) { el.textContent = '--'; return; }
      const num = Number(value);
      if (isPercent){
        const text = Math.abs(num).toFixed(2) + '%';
        el.textContent = (num < 0 ? '-' + text : text);
      } else {
        const text = 'रु ' + Math.abs(num).toFixed(2);
        el.textContent = (num < 0 ? '-' + text : text);
      }
      if (num > 0) el.classList.add('positive');
      else if (num < 0) el.classList.add('negative');
    }

    function calculate(){
      const oddsA = parseFloat($('oddsA').value);
      const oddsB = parseFloat($('oddsB').value);
      const oddsD = parseFloat($('oddsDraw').value);
      const minBet = parseFloat($('minBet').value) || 0;
      const minApplies = $('minBetApplies').value;
      const totalStakeInput = parseFloat($('totalStake').value);

      if (!validateOdds(oddsA,oddsB,oddsD)) return;

      const pA = 1/oddsA; const pB = 1/oddsB; const pD = (oddsD && oddsD>1)? 1/oddsD : 0;
      const sum2 = pA + pB; const sum3 = pA + pB + pD;

      let totalStake = (totalStakeInput && totalStakeInput>0) ? totalStakeInput : Math.max(100, (minBet||0)*2 || 100);

      // 2-way calculations
      const stakeA = totalStake * (pA / sum2);
      const stakeB = totalStake * (pB / sum2);
      const payout2 = stakeA * oddsA; // common payout
      const profit2 = payout2 - totalStake;
      const profitPerc2 = (profit2/totalStake)*100;

      // 3-way
      let stake3a=0, stake3b=0, stake3d=0, payout3val=0, profit3val=0, profitPerc3val=0;
      if (pD>0){
        stake3a = totalStake * (pA / sum3);
        stake3b = totalStake * (pB / sum3);
        stake3d = totalStake * (pD / sum3);
        payout3val = stake3a * oddsA;
        profit3val = payout3val - totalStake;
        profitPerc3val = (profit3val/totalStake)*100;
      }

      // draw protection (only meaningful when in 2-way and draw provided)
      let drawStakeNeeded = null, protectedProfit=null, profitReduction=null, newProfitPercentage=null, drawProb=null;
      if (pD>0){
        drawProb = pD;
        drawStakeNeeded = totalStake / (oddsD - 1);
        protectedProfit = profit2 - drawStakeNeeded;
        profitReduction = drawStakeNeeded;
        const totalOutlay = totalStake + drawStakeNeeded;
        if (isFinite(totalOutlay) && totalOutlay>0) newProfitPercentage = (protectedProfit/totalOutlay)*100;
      }

      // recommendation logic
      let recommendation='--', costbenefit='--';
      if (drawStakeNeeded === null || !isFinite(drawStakeNeeded)){ recommendation='N/A'; costbenefit='N/A';
      } else {
        if (protectedProfit <= 0 || newProfitPercentage === null || newProfitPercentage <= 0){
          recommendation = '❌ Not Recommended'; costbenefit = 'Protection eliminates profit or yields negative return';
        } else {
          const costRatio = drawStakeNeeded/totalStake;
          if (costRatio > 1.5){ recommendation='❌ Not Recommended'; costbenefit='Very High Cost'; }
          else if (costRatio > 0.6){ recommendation='⚠️ Consider Carefully'; costbenefit='High Cost'; }
          else { recommendation='✅ Maybe Worth It'; costbenefit='Low Cost'; }
        }
      }

      // min bet check
      let minWarning='--';
      if (minApplies !== 'none' && minBet>0){
        let stakeOn = 0;
        if (minApplies==='A') stakeOn = stakeA;
        if (minApplies==='B') stakeOn = stakeB;
        if (minApplies==='D') stakeOn = (pD>0)? (totalStake * (pD / sum3)) : 0;
        if (stakeOn < minBet){ minWarning = 'Stake on selected outcome is below minimum — consider raising Total Stake or not using that market'; }
      }

      // populate UI
      $('probA').textContent = pct(pA);
      $('probB').textContent = pct(pB);
      $('probD').textContent = pD? pct(pD): '--';
      $('implied2').textContent = (sum2*100).toFixed(2) + '%';
      $('implied3').textContent = (sum3*100).toFixed(2) + '%';

      $('stakeA').textContent = fmt(stakeA);
      $('stakeB').textContent = fmt(stakeB);
      $('totalStk').textContent = fmt(totalStake);
      $('payout').textContent = fmt(payout2);

      // color/provide sign for 2-way profit
      applyValueClass($('profit'), profit2, false);
      applyValueClass($('profitPerc'), profitPerc2, true);

      // 3-way outputs and coloring (always update the fields so 3-way mode shows result)
      $('stake3A').textContent = fmt(stake3a);
      $('stake3B').textContent = fmt(stake3b);
      $('stake3D').textContent = fmt(stake3d);
      $('totalStk3').textContent = fmt(totalStake);
      $('payout3').textContent = fmt(payout3val);
      applyValueClass($('profit3'), profit3val, false);
      applyValueClass($('profitPerc3'), profitPerc3val, true);

      // draw area
      if (modeSelect.value === '2'){
        if (pD>0){
          drawArea.classList.remove('hide');
          probDrawTile.classList.remove('hide');
          $('drawProb').textContent = pct(drawProb);
          applyValueClass($('origProfit'), profit2, false);

          // draw stake: neutral style
          const dsEl = $('drawStakeNeeded');
          dsEl.textContent = isFinite(drawStakeNeeded) && drawStakeNeeded !== null ? fmt(drawStakeNeeded) : '--';
          dsEl.className = 'value-pill';

          // protected profit: green if positive, red with minus if negative
          applyValueClass($('protProfit'), protectedProfit, false);

          $('profitReduction').textContent = isFinite(profitReduction) && profitReduction !== null ? fmt(profitReduction) : '--';

          if (newProfitPercentage===null||isNaN(newProfitPercentage)) $('newProfitPerc').textContent='--';
          else applyValueClass($('newProfitPerc'), newProfitPercentage, true);

          // recommendation and costbenefit color changes
          const recEl = $('recommendation'); recEl.textContent = recommendation; recEl.className = 'value-pill'; if (recommendation.includes('Not Recommended')) recEl.classList.add('negative'); if (recommendation.includes('Maybe')) recEl.classList.add('positive');
          const cbEl = $('costbenefit'); cbEl.textContent = costbenefit; cbEl.className = 'value-pill'; if (costbenefit.includes('Low Cost')) cbEl.classList.add('positive'); if (costbenefit.includes('High Cost')||costbenefit.includes('Very High')||costbenefit.includes('eliminates')) cbEl.classList.add('negative');
        } else {
          drawArea.classList.add('hide');
          probDrawTile.classList.add('hide');
        }
      } else {
        // in 3-way mode hide drawArea (we already ensured drawOdds required for mode 3)
        drawArea.classList.add('hide');
      }

      // Suggest 3-way vs hedging when it's genuinely better (works in both modes)
      if (pD>0 && sum3 < 1 && isFinite(profit3val) && profit3val > 0 && profit3val > profit2){
        const delta = profit3val - profit2;
        const deltaPercPoints = profitPerc3val - profitPerc2;
        threeWaySuggestText.textContent = `Go 3‑way: extra ${fmt(delta)} (Δ ${deltaPercPoints.toFixed(2)}pp). 3‑way profit ${fmt(profit3val)} — ${profitPerc3val.toFixed(2)}%`;
        threeWaySuggestion.classList.remove('hide');
        threeWaySuggestText.className = 'value-pill positive';
      } else {
        threeWaySuggestion.classList.add('hide');
      }

      // Arb badges
      if (sum3 < 1) { arbBadge.textContent = 'Status: 3‑Way arbitrage possible'; }
      else if (sum2 < 1) { arbBadge.textContent = 'Status: 2‑Way arbitrage possible'; }
      else { arbBadge.textContent = 'Status: No arbitrage detected'; }

      // Suggestions: always show a short checklist after each calculation so user inspects before betting
      const suggestions = [];
      suggestions.push('Confirm available liquidity and bet acceptance at both books/exchanges.');
      suggestions.push('Check account limits, max bet and minimum bet (rounding may change stakes).');
      suggestions.push('Factor in commissions/fees and payout rounding — small arbs may vanish.');
      suggestions.push('Place A/B/D bets quickly to avoid odds movement; consider order of execution.');
      suggestions.push('Verify you have sufficient balance in each book/exchange and available market sizes.');
      if (minWarning !== '--') suggestions.push(minWarning);
      suggestions.push('If suggestion recommends 3‑Way, double-check both markets accept the required draw bet size.');

      suggestionsArea.classList.remove('hide');
      suggestionsText.textContent = suggestions.join('\n\n');

      // min warning wiring (still alert as earlier)
      if (minWarning !== '--') alert(minWarning);
    }

    // wire up
    $('calcBtn').addEventListener('click', (e)=>{ e.preventDefault(); calculate(); });
    $('resetBtn').addEventListener('click', (e)=>{ e.preventDefault(); document.querySelectorAll('input').forEach(i=>i.value=''); clearResults(); });

    // initial state
    setVisibility(); clearResults();

    // preload helpful sample
    window.addEventListener('load', ()=>{ $('oddsA').value='2.1'; $('oddsB').value='2.0'; $('oddsDraw').value='3.2'; $('minBet').value='100'; });
  </script>
</body>
</html>